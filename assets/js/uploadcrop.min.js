/**
 * Uses cropper javascript widget from https://github.com/fengyuanchen/cropper
 *
 * Author: Joseba Juaniz
 * Year: 2015
 * 
 * Modified by: Ashis Kumar Mohanty
 * Year: 2017
 */

!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){"use strict";function c(b,c){this._jcropOptions=c.jcropOptions,this.$container=b.parents(".uploadcrop"),this.$avatarView=this.$container.find(".preview-pane"),this.$avatarViewContainer=this.$avatarView.find(".preview-container"),this.$avatarModal=this.$container.find("div.modal"),this.$loading=this.$container.find(".loading"),this.$avatarModalBody=this.$avatarModal.find(".modal-body"),this.$avatarData=this.$container.find(".cropper-data"),this.$avatarInput=a("#"+c.inputField),this.$avatarDone=this.$container.find(".cropper-done"),this.$avatarBtns=this.$container.find(".cropper-btns"),this.$avatarWrapper=this.$avatarModal.find(".cropper-wrapper"),this.$avatarPreview=this.$avatarModal.find(".cropper-preview"),this.init()}var b=window.console||{log:function(){}};c.prototype={constructor:c,support:{fileList:!!a('<input type="file">').prop("files"),blobURLs:!!window.URL&&URL.createObjectURL,formData:!!window.FormData},init:function(){this.support.datauri=this.support.fileList&&this.support.blobURLs,this.support.formData||this.initIframe(),this.initModal(),this.addListener()},addListener:function(){this.$avatarInput.on("change",a.proxy(this.change,this)),this.$avatarDone.on("click",a.proxy(this.cropDone,this))},initModal:function(){this.$avatarModal.modal({backdrop:!1,show:!1})},initIframe:function(){var c="upload-iframe-"+(new Date).getTime(),d=a("<iframe>").attr({name:c,src:""}),e=this;d.one("load",function(){d.on("load",function(){var c;try{c=a(this).contents().find("body").text()}catch(a){b.log(a.message)}if(c){try{c=a.parseJSON(c)}catch(a){b.log(a.message)}e.submitDone(c)}else e.submitFail("Image upload failed!");e.submitEnd()})}),this.$iframe=d,this.$avatarForm.attr("target",c).after(d.hide())},change:function(){var a,b;this.support.datauri?(a=this.$avatarInput.prop("files"),a.length>0&&(b=a[0],this.$avatarModal.modal("show"),this.isImageFile(b)?(this.url&&URL.revokeObjectURL(this.url),this.url=URL.createObjectURL(b),this.startCropper()):(this.alert("Please upload an image file."),this.$avatarInput.val("")))):(b=this.$avatarInput.val(),this.isImageFile(b)&&this.syncUpload())},rotate:function(b){var c;this.active&&(c=a(b.target).data(),c.method&&this.$img.cropper(c.method,c.option))},isImageFile:function(a){return a.type?/^image\/\w+$/.test(a.type):/\.(jpg|jpeg|png|gif)$/.test(a)},startCropper:function(){var b=this;if(this.active)this.$img.cropper("replace",this.url);else{this.$img=a('<img src="'+this.url+'">'),this.$avatarWrapper.empty().html(this.$img);var c=this._jcropOptions;c.preview=this.$avatarPreview.selector,c.crop=function(a){var c=['{"x":'+a.x,'"y":'+a.y,'"height":'+a.height,'"width":'+a.width,'"rotate":'+(b._jcropOptions.rotatable?a.rotate:0)+"}"].join();b.$avatarData.val(c)},this.$img.cropper(c),this.active=!0}this.$avatarModal.one("hidden.bs.modal",function(){b.$avatarPreview.empty(),b.clearAlert(),b.stopCropper()})},stopCropper:function(){this.active&&(this.$img.cropper("destroy"),this.$img.remove(),this.active=!1)},syncUpload:function(){this.$avatarDone.click()},cropDone:function(){return!!this.$avatarInput.val()&&(this.$avatarViewContainer.height(this.$avatarPreview.height()),this.$avatarViewContainer.width(this.$avatarPreview.width()),this.$avatarViewContainer.html(this.$avatarPreview.html()),this.$container.addClass("cropper-done"),this.stopCropper(),this.$avatarModal.modal("hide"),void 0)},alert:function(a){var b=['<div class="alert alert-danger cropper-alert alert-dismissable">','<button type="button" class="close" data-dismiss="alert">&times;</button>',a,"</div>"].join("");this.$avatarModalBody.prepend(b);var c=this;this.$avatarModal.one("hidden.bs.modal",function(){c.clearAlert()})},clearAlert:function(){this.$avatarModalBody.find("div.alert").remove()}},a.fn.uploadCrop=function(b){new c(a(this),b)}});
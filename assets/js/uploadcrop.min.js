/**
 * Uses cropper javascript widget from https://github.com/fengyuanchen/cropper
 *
 * Author: Joseba Juaniz
 * Year: 2015
 * 
 * Modified by: Ashis Kumar Mohanty
 * Year: 2018
 */

!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?t(require("jquery")):t(jQuery)}(function(t){"use strict";var a=window.console||{log:function(){}};function i(a,i){this._jcropOptions=i.jcropOptions,this.$container=a.parents(".uploadcrop"),this.$avatarView=this.$container.find(".preview-pane"),this.$avatarViewContainer=this.$avatarView.find(".preview-container"),this.$avatarModal=this.$container.find("div.modal"),this.$loading=this.$container.find(".loading"),this.$avatarModalBody=this.$avatarModal.find(".modal-body"),this.$avatarData=this.$container.find(".cropper-data"),this.$avatarInput=t("#"+i.inputField),this.$avatarDone=this.$container.find(".cropper-done"),this.$avatarBtns=this.$container.find(".cropper-btns"),this.$avatarWrapper=this.$avatarModal.find(".cropper-wrapper"),this.$avatarPreview=this.$avatarModal.find(".cropper-preview"),this.init()}i.prototype={constructor:i,support:{fileList:!!t('<input type="file">').prop("files"),blobURLs:!!window.URL&&URL.createObjectURL,formData:!!window.FormData},init:function(){this.support.datauri=this.support.fileList&&this.support.blobURLs,this.support.formData||this.initIframe(),this.initModal(),this.addListener()},addListener:function(){this.$avatarInput.on("change",t.proxy(this.change,this)),this.$avatarDone.on("click",t.proxy(this.cropDone,this))},initModal:function(){this.$avatarModal.modal({backdrop:"static",keyboard:!1,show:!1})},initIframe:function(){var i="upload-iframe-"+(new Date).getTime(),e=t("<iframe>").attr({name:i,src:""}),r=this;e.one("load",function(){e.on("load",function(){var i;try{i=t(this).contents().find("body").text()}catch(t){a.log(t.message)}if(i){try{i=t.parseJSON(i)}catch(t){a.log(t.message)}r.submitDone(i)}else r.submitFail("Image upload failed!");r.submitEnd()})}),this.$iframe=e,this.$avatarForm.attr("target",i).after(e.hide())},change:function(){var t,a;if(this.support.datauri){if((t=this.$avatarInput.prop("files")).length>0)if(a=t[0],this.$avatarModal.modal("show"),this.isImageFile(a)){this.url&&URL.revokeObjectURL(this.url),this.url=URL.createObjectURL(a);var i=this;setTimeout(function(){i.startCropper()},500)}else this.alert("Please upload an image file."),this.$avatarInput.val("")}else a=this.$avatarInput.val(),this.isImageFile(a)&&this.syncUpload()},rotate:function(a){var i;this.active&&(i=t(a.target).data()).method&&this.$img.cropper(i.method,i.option)},isImageFile:function(t){return t.type?/^image\/\w+$/.test(t.type):/\.(jpg|jpeg|png|gif)$/.test(t)},startCropper:function(){var a=this;if(this.active)this.$img.cropper("replace",this.url);else{this.$img=t('<img src="'+this.url+'">'),this.$avatarWrapper.empty().html(this.$img);var i=this._jcropOptions;i.preview=this.$avatarPreview,i.crop=function(t){var i=['{"x":'+t.x,'"y":'+t.y,'"height":'+t.height,'"width":'+t.width,'"rotate":'+(a._jcropOptions.rotatable?t.rotate:0)+"}"].join();a.$avatarData.val(i)},this.$img.cropper(i),this.active=!0}this.$avatarModal.one("hidden.bs.modal",function(){a.$avatarPreview.empty(),a.clearAlert(),a.stopCropper()})},stopCropper:function(){this.active&&(this.$img.cropper("destroy"),this.$img.remove(),this.active=!1)},syncUpload:function(){this.$avatarDone.click()},cropDone:function(){if(!this.$avatarInput.val())return!1;this.$avatarViewContainer.height(this.$avatarPreview.height()),this.$avatarViewContainer.width(this.$avatarPreview.width()),this.$avatarViewContainer.html(this.$avatarPreview.html()),this.$container.addClass("cropper-done"),this.stopCropper(),this.$avatarModal.modal("hide")},alert:function(t){var a=['<div class="alert alert-danger cropper-alert alert-dismissable">','<button type="button" class="close" data-dismiss="alert">&times;</button>',t,"</div>"].join("");this.$avatarModalBody.prepend(a);var i=this;this.$avatarModal.one("hidden.bs.modal",function(){i.clearAlert()})},clearAlert:function(){this.$avatarModalBody.find("div.alert").remove()}};var e="uploadCrop",r=t.fn.uploadCrop;t.fn.uploadCrop=function(a){var r=void 0;return this.each(function(o,n){var s=t(n),p=s.data(e);if(!p){var h=t.extend({},s.data(),t.isPlainObject(a)&&a);s.data(e,p=new i(s,h))}if("string"==typeof a){var d=p[a];t.isFunction(d)&&(r=d.apply(p,args))}return void 0!==r?r:this})},t.fn.uploadCrop.noConflict=function(){return t.fn.uploadCrop=r,this}});